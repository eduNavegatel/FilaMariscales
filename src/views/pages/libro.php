<?php 
// Datos del libro - Historia de la Filá Mariscales
$libro_paginas = [
    [
        'titulo' => 'Fundación de la Filá Mariscales',
        'subtitulo' => 'Capítulo I - Los Orígenes Sagrados',
        'contenido' => [
            'En el año de Nuestro Señor 1985, cuando las estrellas se alinearon en el firmamento de Elche, un grupo de visionarios decidió crear algo extraordinario. Nacía así la Filá Mariscales de Caballeros Templarios, una comparsa que honraría la tradición medieval y el espíritu de los templarios.',
            'Los fundadores, inspirados por la nobleza y el honor de los caballeros templarios, establecieron los cimientos de lo que hoy es una de las filaes más respetadas de las Fiestas de Moros y Cristianos.',
            'Desde el primer momento, se decidió que la filá representaría a los Caballeros Templarios, una de las órdenes militares más importantes de la Edad Media, conocida por su valentía, honor y devoción a la fe cristiana.',
            'El nombre "Mariscales" fue elegido para honrar a los mariscales medievales, oficiales de alto rango que comandaban las tropas en batalla, simbolizando así el liderazgo y la estrategia militar.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '1985'
    ],
    [
        'titulo' => 'Los Primeros Años',
        'subtitulo' => 'Capítulo II - Construyendo la Tradición',
        'contenido' => [
            'Los primeros años fueron de aprendizaje y consolidación. Los miembros fundadores trabajaron incansablemente para establecer las bases de la filá, creando los estatutos, diseñando los trajes y organizando las primeras participaciones en las fiestas.',
            'En 1986, la Filá Mariscales participó por primera vez en las Fiestas de Moros y Cristianos de Elche, causando una gran impresión con sus trajes de caballeros templarios y su organización impecable.',
            'Durante estos años iniciales, se establecieron las tradiciones que perduran hasta hoy: el respeto por la historia, la devoción a la tradición, y el compromiso con la excelencia en cada desfile y acto.',
            'Los primeros trajes fueron diseñados con gran atención al detalle histórico, basándose en las vestimentas reales de los caballeros templarios, con sus característicos mantos blancos con la cruz roja.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '1986-1990'
    ],
    [
        'titulo' => 'Época de Crecimiento',
        'subtitulo' => 'Capítulo III - Expansión y Reconocimiento',
        'contenido' => [
            'Durante la década de los 90, la Filá Mariscales experimentó un crecimiento significativo en su número de miembros y en su prestigio dentro de las fiestas. Cada año, nuevos caballeros se unían a la hermandad.',
            'En 1995, la filá celebró su décimo aniversario con una gran ceremonia que incluyó un desfile especial por las calles de Elche, conmemorando los logros alcanzados y renovando el compromiso con la tradición.',
            'Durante estos años, la filá comenzó a participar en eventos fuera de Elche, representando a la ciudad en fiestas de Moros y Cristianos de otras localidades, llevando el nombre de Elche y la tradición templaria por toda España.',
            'Se establecieron las primeras relaciones de hermanamiento con otras filaes templarias de diferentes ciudades, creando una red de hermandad que perdura hasta nuestros días.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1544966503-7cc5ac882d5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '1990-2000'
    ],
    [
        'titulo' => 'Siglo XXI - Modernización',
        'subtitulo' => 'Capítulo IV - Tradición y Progreso',
        'contenido' => [
            'Con la llegada del nuevo milenio, la Filá Mariscales emprendió un proceso de modernización que mantendría la esencia tradicional pero incorporaría las ventajas de la tecnología y la comunicación moderna.',
            'En 2005, se celebró el vigésimo aniversario con un evento que reunió a todas las generaciones de la filá, desde los fundadores hasta los miembros más jóvenes, demostrando la continuidad y vitalidad de la tradición.',
            'Durante estos años, se mejoraron significativamente los trajes y equipamiento, incorporando materiales más duraderos y cómodos, pero manteniendo la fidelidad histórica a los caballeros templarios.',
            'Se establecieron programas de formación para nuevos miembros, asegurando que cada generación comprenda y valore la historia y tradición de la filá, garantizando así la continuidad del legado templario.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '2000-2010'
    ],
    [
        'titulo' => 'Era Digital y Expansión',
        'subtitulo' => 'Capítulo V - Conectando Generaciones',
        'contenido' => [
            'En la década de 2010, la Filá Mariscales abrazó la era digital, creando presencia en redes sociales y desarrollando una página web que permitiera compartir la historia y actividades de la filá con el mundo.',
            'En 2015, se celebró el trigésimo aniversario con un evento que incluyó exposiciones históricas, conferencias sobre la historia templaria, y un gran desfile que atrajo a miles de espectadores.',
            'Durante estos años, la filá comenzó a organizar eventos culturales y educativos, incluyendo charlas sobre historia medieval, talleres de heráldica, y visitas a castillos y monumentos templarios.',
            'Se establecieron programas de intercambio con otras organizaciones templarias internacionales, expandiendo el alcance y la influencia de la Filá Mariscales más allá de las fronteras españolas.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '2010-2020'
    ],
    [
        'titulo' => 'El Presente y Futuro',
        'subtitulo' => 'Capítulo VI - Legado Eterno',
        'contenido' => [
            'Hoy, en 2024, la Filá Mariscales de Caballeros Templarios se encuentra en su momento más fuerte, con más de 150 miembros activos y una reputación que trasciende las fronteras de Elche.',
            'La filá continúa siendo un pilar fundamental de las Fiestas de Moros y Cristianos, manteniendo viva la tradición medieval y el espíritu de los caballeros templarios para las generaciones futuras.',
            'Los proyectos actuales incluyen la digitalización completa del archivo histórico, la creación de un museo virtual, y la expansión de los programas educativos para jóvenes interesados en la historia medieval.',
            'El compromiso con la tradición, el honor y la excelencia sigue siendo el pilar fundamental de la Filá Mariscales, asegurando que el legado de los caballeros templarios perdure por muchos siglos más.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '2020-Presente'
    ]
];

$total_paginas = count($libro_paginas);
?>

<!-- Hero Section -->
<section class="hero-section py-5" style="background: rgba(0, 0, 0, 0.1); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10 text-center">
                <h1 class="display-4 fw-bold text-gradient mb-4">
                    <i class="bi bi-book-open me-3"></i>Libro de la Historia
                </h1>
                <p class="lead mb-5">Crónicas de la Filá Mariscales de Caballeros Templarios</p>
                <div class="book-stats d-flex justify-content-center gap-4 mb-5">
                    <div class="stat-item">
                        <h3 class="text-gradient mb-0"><?php echo $total_paginas; ?></h3>
                        <small class="text-muted">Capítulos</small>
                    </div>
                    <div class="stat-item">
                        <h3 class="text-gradient mb-0">39</h3>
                        <small class="text-muted">Años de Historia</small>
                    </div>
                    <div class="stat-item">
                        <h3 class="text-gradient mb-0">150+</h3>
                        <small class="text-muted">Miembros</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 3D Book Container -->
<section class="book-3d-section py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <div class="book-3d-container">
                    <div class="book-3d-controls">
                        <button id="prevPage" class="btn btn-outline-danger">
                            <i class="bi bi-chevron-left me-2"></i>Anterior
                        </button>
                        <div class="page-info">
                            <span id="currentPage">1</span> de <?php echo $total_paginas; ?>
                        </div>
                        <button id="nextPage" class="btn btn-outline-danger">
                            Siguiente<i class="bi bi-chevron-right ms-2"></i>
                        </button>
                    </div>
                    
                    <div class="book-3d-wrapper">
                        <div class="book-3d" id="book3d">
                            <!-- Left Page (Back) -->
                            <div class="book-page book-left">
                                <div class="page-content">
                                    <div class="page-header">
                                        <div class="page-number">Capítulo <span id="leftPageNumber">1</span></div>
                                        <div class="page-date" id="leftPageDate">1985</div>
                                    </div>
                                    
                                    <div class="page-body">
                                        <div class="row h-100">
                                            <div class="col-lg-8">
                                                <h2 class="page-title" id="leftPageTitle">Fundación de la Filá Mariscales</h2>
                                                <h4 class="page-subtitle" id="leftPageSubtitle">Capítulo I - Los Orígenes Sagrados</h4>
                                                
                                                <div class="page-text" id="leftPageText">
                                                    <p>En el año de Nuestro Señor 1985, cuando las estrellas se alinearon en el firmamento de Elche, un grupo de visionarios decidió crear algo extraordinario. Nacía así la Filá Mariscales de Caballeros Templarios, una comparsa que honraría la tradición medieval y el espíritu de los templarios.</p>
                                                    <p>Los fundadores, inspirados por la nobleza y el honor de los caballeros templarios, establecieron los cimientos de lo que hoy es una de las filaes más respetadas de las Fiestas de Moros y Cristianos.</p>
                                                </div>
                                            </div>
                                            
                                            <div class="col-lg-4">
                                                <div class="page-image">
                                                    <img id="leftPageImage" src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                                                         alt="Imagen del capítulo" 
                                                         class="img-fluid">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="page-footer">
                                        <div class="page-quote">
                                            <blockquote>
                                                <p>
                                                    <i class="bi bi-quote me-2"></i>
                                                    "La tradición no es adorar las cenizas, sino mantener viva la llama."
                                                </p>
                                                <footer>
                                                    <cite>Filá Mariscales</cite>
                                                </footer>
                                            </blockquote>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Page (Front) -->
                            <div class="book-page book-right">
                                <div class="page-content">
                                    <div class="page-header">
                                        <div class="page-number">Capítulo <span id="rightPageNumber">2</span></div>
                                        <div class="page-date" id="rightPageDate">1986-1990</div>
                                    </div>
                                    
                                    <div class="page-body">
                                        <div class="row h-100">
                                            <div class="col-lg-8">
                                                <h2 class="page-title" id="rightPageTitle">Los Primeros Años</h2>
                                                <h4 class="page-subtitle" id="rightPageSubtitle">Capítulo II - Construyendo la Tradición</h4>
                                                
                                                <div class="page-text" id="rightPageText">
                                                    <p>Los primeros años fueron de aprendizaje y consolidación. Los miembros fundadores trabajaron incansablemente para establecer las bases de la filá, creando los estatutos, diseñando los trajes y organizando las primeras participaciones en las fiestas.</p>
                                                    <p>En 1986, la Filá Mariscales participó por primera vez en las Fiestas de Moros y Cristianos de Elche, causando una gran impresión con sus trajes de caballeros templarios y su organización impecable.</p>
                                                </div>
                                            </div>
                                            
                                            <div class="col-lg-4">
                                                <div class="page-image">
                                                    <img id="rightPageImage" src="https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                                                         alt="Imagen del capítulo" 
                                                         class="img-fluid">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="page-footer">
                                        <div class="page-quote">
                                            <blockquote>
                                                <p>
                                                    <i class="bi bi-quote me-2"></i>
                                                    "La tradición no es adorar las cenizas, sino mantener viva la llama."
                                                </p>
                                                <footer>
                                                    <cite>Filá Mariscales</cite>
                                                </footer>
                                            </blockquote>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Book Spine -->
                            <div class="book-spine">
                                <div class="spine-content">
                                    <h3>Historia de la Filá Mariscales</h3>
                                    <div class="spine-decoration"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Chapter Navigation -->
<section class="chapter-nav py-4">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <h4 class="text-center mb-4">Navegación por Capítulos</h4>
                <div class="chapter-grid">
                    <?php foreach ($libro_paginas as $index => $pagina): ?>
                    <button class="chapter-btn" data-page="<?php echo $index + 1; ?>">
                        <div class="chapter-number"><?php echo $index + 1; ?></div>
                        <div class="chapter-title"><?php echo $pagina['titulo']; ?></div>
                        <div class="chapter-date"><?php echo $pagina['fecha']; ?></div>
                    </button>
                    <?php endforeach; ?>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
/* Hero Section */
.hero-section {
    background: linear-gradient(135deg, rgba(220, 20, 60, 0.05) 0%, rgba(255, 255, 255, 0.7) 50%, rgba(220, 20, 60, 0.05) 100%);
    border-bottom: 3px solid var(--primary);
    backdrop-filter: blur(5px);
}

.book-stats .stat-item {
    text-align: center;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 10px;
    border: 2px solid var(--primary);
    min-width: 120px;
    backdrop-filter: blur(10px);
}

/* 3D Book Styles */
.book-3d-section {
    background: linear-gradient(135deg, rgba(248, 249, 250, 0.8) 0%, rgba(233, 236, 239, 0.8) 100%);
    min-height: 80vh;
    perspective: 2000px;
}

.book-3d-container {
    position: relative;
    max-width: 1400px;
    margin: 0 auto;
}

.book-3d-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.page-info {
    font-family: 'Cinzel', serif;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
}

.book-3d-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 700px;
    perspective: 2000px;
}

.book-3d {
    position: relative;
    width: 800px;
    height: 600px;
    transform-style: preserve-3d;
    transition: transform 0.8s ease-in-out;
    cursor: pointer;
}

/* Efecto de hover del libro completo manejado por JavaScript */

.book-page {
    position: absolute;
    width: 400px;
    height: 600px;
    background: #fff;
    border: 2px solid #8B4513;
    box-shadow: 
        0 0 20px rgba(0, 0, 0, 0.3),
        inset 0 0 20px rgba(0, 0, 0, 0.1);
    transform-style: preserve-3d;
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    z-index: 1;
}

.book-left {
    left: 0;
    transform-origin: right center;
    border-right: 1px solid #8B4513;
}

.book-left:hover {
    transform: rotateY(20deg);
    background: #f0f0f0;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
}

.book-right {
    right: 0;
    transform-origin: left center;
    border-left: 1px solid #8B4513;
}

.book-right:hover {
    transform: rotateY(-20deg);
    background: #f0f0f0;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
}

/* Efecto de volteo de página */
.page-flipping {
    animation: pageFlip 1s ease-in-out;
}

.page-flipping .book-left {
    transform: rotateY(45deg) !important;
    z-index: 20 !important;
    box-shadow: 0 0 60px rgba(0, 0, 0, 0.7), -25px 0 50px rgba(0, 0, 0, 0.5) !important;
}

.page-flipping .book-right {
    transform: rotateY(-45deg) !important;
    z-index: 20 !important;
    box-shadow: 0 0 60px rgba(0, 0, 0, 0.7), 25px 0 50px rgba(0, 0, 0, 0.5) !important;
}

@keyframes pageFlip {
    0% {
        transform: rotateY(0deg) scale(1);
        filter: brightness(1);
    }
    25% {
        transform: rotateY(-10deg) rotateX(5deg) scale(1.05);
        filter: brightness(1.1);
    }
    50% {
        transform: rotateY(-15deg) rotateX(8deg) scale(1.1);
        filter: brightness(1.2);
    }
    75% {
        transform: rotateY(-10deg) rotateX(5deg) scale(1.05);
        filter: brightness(1.1);
    }
    100% {
        transform: rotateY(0deg) scale(1);
        filter: brightness(1);
    }
}

.book-spine {
    position: absolute;
    left: 50%;
    top: 0;
    width: 20px;
    height: 600px;
    background: linear-gradient(90deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
    transform: translateX(-50%);
    z-index: -1;
    box-shadow: 
        -5px 0 15px rgba(0, 0, 0, 0.3),
        5px 0 15px rgba(0, 0, 0, 0.3);
}

.spine-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(-90deg);
    color: #DAA520;
    font-family: 'Cinzel', serif;
    font-size: 0.8rem;
    font-weight: 700;
    text-align: center;
    white-space: nowrap;
}

.spine-decoration {
    width: 100%;
    height: 2px;
    background: #DAA520;
    margin: 10px 0;
}

.page-content {
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 0;
    overflow: hidden;
    background: 
        linear-gradient(90deg, transparent 0%, rgba(0,0,0,0.02) 50%, transparent 100%),
        radial-gradient(circle at 50% 50%, rgba(0,0,0,0.05) 0%, transparent 70%);
}

.page-header {
    background: linear-gradient(135deg, rgba(220, 20, 60, 0.9) 0%, rgba(139, 0, 0, 0.9) 100%);
    color: white;
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: 'Cinzel', serif;
    border-bottom: 2px solid #8B4513;
}

.page-number {
    font-size: 1.2rem;
    font-weight: 700;
}

.page-date {
    font-size: 0.9rem;
    opacity: 0.9;
}

.page-body {
    flex: 1;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.95);
    overflow-y: auto;
}

.page-title {
    font-family: 'Cinzel', serif;
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--primary);
    border-bottom: 2px solid var(--accent);
    padding-bottom: 0.5rem;
    margin-bottom: 0.5rem;
}

.page-subtitle {
    font-family: 'Crimson Text', serif;
    font-style: italic;
    font-size: 1rem;
    color: #666;
    margin-bottom: 1rem;
}

.page-text p {
    font-family: 'Crimson Text', serif;
    font-size: 0.9rem;
    line-height: 1.6;
    text-align: justify;
    color: #333;
    margin-bottom: 0.8rem;
}

.page-image {
    height: 200px;
    display: flex;
    align-items: center;
    margin-top: 1rem;
}

.page-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid var(--accent);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
}

.page-footer {
    background: linear-gradient(135deg, rgba(248, 249, 250, 0.9) 0%, rgba(233, 236, 239, 0.9) 100%);
    padding: 1rem;
    border-top: 2px solid var(--primary);
}

.page-quote {
    text-align: center;
    font-style: italic;
}

.page-quote blockquote {
    border-left: 3px solid var(--primary);
    padding-left: 0.8rem;
    margin: 0;
}

.page-quote p {
    font-size: 0.8rem;
    color: #555;
    margin-bottom: 0.3rem;
}

.page-quote cite {
    font-size: 0.7rem;
    color: var(--primary);
    font-weight: 600;
}

/* Chapter Navigation */
.chapter-nav {
    background: rgba(248, 249, 250, 0.8);
    border-top: 2px solid var(--primary);
    backdrop-filter: blur(10px);
}

.chapter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.chapter-btn {
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid var(--primary);
    border-radius: 10px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    backdrop-filter: blur(5px);
}

.chapter-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
}

.chapter-btn.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
}

.chapter-number {
    font-family: 'Cinzel', serif;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.chapter-title {
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.chapter-date {
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Responsive */
@media (max-width: 768px) {
    .book-3d-wrapper {
        height: 500px;
    }
    
    .book-3d {
        width: 600px;
        height: 450px;
    }
    
    .book-page {
        width: 300px;
        height: 450px;
    }
    
    .page-body {
        padding: 1rem;
    }
    
    .page-title {
        font-size: 1.4rem;
    }
    
    .chapter-grid {
        grid-template-columns: 1fr;
    }
    
    .book-stats {
        flex-direction: column;
        gap: 1rem;
    }
    
    .book-3d-controls {
        flex-direction: column;
        gap: 1rem;
    }
}

@media (max-width: 480px) {
    .book-3d {
        width: 400px;
        height: 300px;
    }
    
    .book-page {
        width: 200px;
        height: 300px;
    }
    
    .page-header {
        padding: 1rem;
    }
    
    .page-body {
        padding: 0.8rem;
    }
    
    .page-title {
        font-size: 1.2rem;
    }
    
    .page-text p {
        font-size: 0.8rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Datos del libro desde PHP
    const libroPaginas = <?php echo json_encode($libro_paginas); ?>;
    
    const chapterBtns = document.querySelectorAll('.chapter-btn');
    const prevBtn = document.getElementById('prevPage');
    const nextBtn = document.getElementById('nextPage');
    const currentPageSpan = document.getElementById('currentPage');
    
    // Elementos de las páginas
    const leftPageNumber = document.getElementById('leftPageNumber');
    const leftPageDate = document.getElementById('leftPageDate');
    const leftPageTitle = document.getElementById('leftPageTitle');
    const leftPageSubtitle = document.getElementById('leftPageSubtitle');
    const leftPageText = document.getElementById('leftPageText');
    const leftPageImage = document.getElementById('leftPageImage');
    
    const rightPageNumber = document.getElementById('rightPageNumber');
    const rightPageDate = document.getElementById('rightPageDate');
    const rightPageTitle = document.getElementById('rightPageTitle');
    const rightPageSubtitle = document.getElementById('rightPageSubtitle');
    const rightPageText = document.getElementById('rightPageText');
    const rightPageImage = document.getElementById('rightPageImage');
    
    let currentPage = 1;
    const totalPages = libroPaginas.length;
    let isFlipping = false;
    
    function updatePageContent(pageIndex, isLeftPage) {
        const pagina = libroPaginas[pageIndex];
        if (!pagina) return;
        
        const pageNumber = pageIndex + 1;
        const elements = isLeftPage ? {
            number: leftPageNumber,
            date: leftPageDate,
            title: leftPageTitle,
            subtitle: leftPageSubtitle,
            text: leftPageText,
            image: leftPageImage
        } : {
            number: rightPageNumber,
            date: rightPageDate,
            title: rightPageTitle,
            subtitle: rightPageSubtitle,
            text: rightPageText,
            image: rightPageImage
        };
        
        elements.number.textContent = pageNumber;
        elements.date.textContent = pagina.fecha;
        elements.title.textContent = pagina.titulo;
        elements.subtitle.textContent = pagina.subtitulo;
        
        // Actualizar texto
        elements.text.innerHTML = '';
        pagina.contenido.forEach(parrafo => {
            const p = document.createElement('p');
            p.textContent = parrafo;
            elements.text.appendChild(p);
        });
        
        // Actualizar imagen
        elements.image.src = pagina.imagen;
        elements.image.alt = pagina.titulo;
    }
    
    function showPage(pageNumber) {
        if (isFlipping || pageNumber < 1 || pageNumber > totalPages) return;
        
        isFlipping = true;
        
        // Calcular qué páginas mostrar
        const leftPageIndex = pageNumber - 1;
        const rightPageIndex = pageNumber;
        
        // Actualizar contenido de las páginas
        updatePageContent(leftPageIndex, true);
        if (rightPageIndex < totalPages) {
            updatePageContent(rightPageIndex, false);
        } else {
            // Si no hay página derecha, ocultar o mostrar mensaje
            rightPageTitle.textContent = 'Fin del Libro';
            rightPageSubtitle.textContent = 'La historia continúa...';
            rightPageText.innerHTML = '<p>Gracias por leer la historia de la Filá Mariscales de Caballeros Templarios. La tradición continúa con cada nueva generación.</p>';
            rightPageImage.src = 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80';
        }
        
        // Actualizar navegación
            currentPageSpan.textContent = pageNumber;
            
        // Actualizar botones de capítulo
            chapterBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            
            const targetBtn = document.querySelector(`.chapter-btn[data-page="${pageNumber}"]`);
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
            
        // Actualizar botones de navegación
            prevBtn.disabled = pageNumber === 1;
            nextBtn.disabled = pageNumber === totalPages;
            
        // Efecto de volteo realista como un libro de verdad
        const book3d = document.getElementById('book3d');
        const bookLeft = document.querySelector('.book-left');
        const bookRight = document.querySelector('.book-right');
        
        console.log('Aplicando efecto de volteo realista...');
        
        // Determinar qué página se está volteando basado en la dirección del cambio
        const isGoingForward = pageNumber > currentPage;
        const flippingPage = isGoingForward ? bookRight : bookLeft;
        const staticPage = isGoingForward ? bookLeft : bookRight;
        
        if (flippingPage && staticPage) {
            // La página que se voltea se coloca encima
            flippingPage.style.zIndex = '30';
            flippingPage.style.transform = isGoingForward ? 
                'rotateY(-180deg) translateZ(50px)' : 
                'rotateY(180deg) translateZ(50px)';
            flippingPage.style.transition = 'transform 1s ease-in-out';
            flippingPage.style.boxShadow = '0 0 80px rgba(0, 0, 0, 0.8)';
            
            // La página estática se mantiene abajo
            staticPage.style.zIndex = '1';
            staticPage.style.transform = 'rotateY(0deg)';
            staticPage.style.transition = 'transform 1s ease-in-out';
            
            // El libro completo se inclina ligeramente
            book3d.style.transform = 'rotateY(-5deg) rotateX(3deg)';
            book3d.style.transition = 'transform 1s ease-in-out';
        }
        
        setTimeout(() => {
            // Restaurar posiciones
            if (flippingPage) {
                flippingPage.style.transform = 'rotateY(0deg) translateZ(0px)';
                flippingPage.style.zIndex = '1';
                flippingPage.style.boxShadow = '0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.1)';
            }
            
            if (staticPage) {
                staticPage.style.transform = 'rotateY(0deg)';
                staticPage.style.zIndex = '1';
            }
            
            book3d.style.transform = 'rotateY(0deg) rotateX(0deg)';
            
            console.log('Efecto de volteo realista completado');
            isFlipping = false;
        }, 1000);
    }
    
    // Event listeners
    prevBtn.addEventListener('click', () => {
        if (currentPage > 1 && !isFlipping) {
            currentPage--;
            showPage(currentPage);
        }
    });
    
    nextBtn.addEventListener('click', () => {
        if (currentPage < totalPages && !isFlipping) {
            currentPage++;
            showPage(currentPage);
        }
    });
    
    chapterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const pageNumber = parseInt(btn.dataset.page);
            if (pageNumber !== currentPage && !isFlipping) {
                currentPage = pageNumber;
                showPage(pageNumber);
            }
        });
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (isFlipping) return;
        
        if (e.key === 'ArrowLeft' && currentPage > 1) {
            currentPage--;
            showPage(currentPage);
        } else if (e.key === 'ArrowRight' && currentPage < totalPages) {
            currentPage++;
            showPage(currentPage);
        }
    });
    
    // Touch/swipe support
    let startX = 0;
    let startY = 0;
    
    document.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
    });
    
    document.addEventListener('touchend', (e) => {
        if (isFlipping) return;
        
        const endX = e.changedTouches[0].clientX;
        const endY = e.changedTouches[0].clientY;
        const diffX = startX - endX;
        const diffY = startY - endY;
        
        // Only trigger if horizontal swipe is more significant than vertical
        if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
            if (diffX > 0 && currentPage < totalPages) {
                // Swipe left - next page
                currentPage++;
                showPage(currentPage);
            } else if (diffX < 0 && currentPage > 1) {
                // Swipe right - previous page
                currentPage--;
                showPage(currentPage);
            }
        }
    });
    
    // Efecto de hover con JavaScript para asegurar que funcione
    const bookLeft = document.querySelector('.book-left');
    const bookRight = document.querySelector('.book-right');
    
    if (bookLeft) {
        console.log('Página izquierda encontrada');
        bookLeft.addEventListener('mouseenter', function() {
            console.log('Hover en página izquierda - preparando volteo hacia atrás');
            this.style.transform = 'rotateY(15deg) translateZ(10px)';
            this.style.background = '#f0f0f0';
            this.style.boxShadow = '0 0 40px rgba(0, 0, 0, 0.6)';
            this.style.zIndex = '15';
            this.style.transition = 'all 0.3s ease';
            
            // Cambiar a la página anterior después de un breve delay
            setTimeout(() => {
                if (currentPage > 1 && !isFlipping) {
                    currentPage--;
                    showPage(currentPage);
                }
            }, 500);
        });
        
        bookLeft.addEventListener('mouseleave', function() {
            console.log('Salida de hover página izquierda');
            this.style.transform = 'rotateY(0deg) translateZ(0px)';
            this.style.background = '#fff';
            this.style.boxShadow = '0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.1)';
            this.style.zIndex = '1';
        });
    } else {
        console.log('Página izquierda NO encontrada');
    }
    
    if (bookRight) {
        console.log('Página derecha encontrada');
        bookRight.addEventListener('mouseenter', function() {
            console.log('Hover en página derecha - preparando volteo hacia adelante');
            this.style.transform = 'rotateY(-15deg) translateZ(10px)';
            this.style.background = '#f0f0f0';
            this.style.boxShadow = '0 0 40px rgba(0, 0, 0, 0.6)';
            this.style.zIndex = '15';
            this.style.transition = 'all 0.3s ease';
            
            // Cambiar a la página siguiente después de un breve delay
            setTimeout(() => {
                if (currentPage < totalPages && !isFlipping) {
                    currentPage++;
                    showPage(currentPage);
                }
            }, 500);
        });
        
        bookRight.addEventListener('mouseleave', function() {
            console.log('Salida de hover página derecha');
            this.style.transform = 'rotateY(0deg) translateZ(0px)';
            this.style.background = '#fff';
            this.style.boxShadow = '0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.1)';
            this.style.zIndex = '1';
        });
    } else {
        console.log('Página derecha NO encontrada');
    }
    
    // Initialize
    showPage(1);
});
</script>