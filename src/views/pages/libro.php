<?php 
// Datos del libro - Historia de la Filá Mariscales
$libro_paginas = [
    [
        'titulo' => 'Fundación de la Filá Mariscales',
        'subtitulo' => 'Capítulo I - Los Orígenes Sagrados',
        'contenido' => [
            'En el año de Nuestro Señor 1985, cuando las estrellas se alinearon en el firmamento de Elche, un grupo de visionarios decidió crear algo extraordinario. Nacía así la Filá Mariscales de Caballeros Templarios, una comparsa que honraría la tradición medieval y el espíritu de los templarios.',
            'Los fundadores, inspirados por la nobleza y el honor de los caballeros templarios, establecieron los cimientos de lo que hoy es una de las filaes más respetadas de las Fiestas de Moros y Cristianos.',
            'Desde el primer momento, se decidió que la filá representaría a los Caballeros Templarios, una de las órdenes militares más importantes de la Edad Media, conocida por su valentía, honor y devoción a la fe cristiana.',
            'El nombre "Mariscales" fue elegido para honrar a los mariscales medievales, oficiales de alto rango que comandaban las tropas en batalla, simbolizando así el liderazgo y la estrategia militar.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '1985'
    ],
    [
        'titulo' => 'Los Primeros Años',
        'subtitulo' => 'Capítulo II - Construyendo la Tradición',
        'contenido' => [
            'Los primeros años fueron de aprendizaje y consolidación. Los miembros fundadores trabajaron incansablemente para establecer las bases de la filá, creando los estatutos, diseñando los trajes y organizando las primeras participaciones en las fiestas.',
            'En 1986, la Filá Mariscales participó por primera vez en las Fiestas de Moros y Cristianos de Elche, causando una gran impresión con sus trajes de caballeros templarios y su organización impecable.',
            'Durante estos años iniciales, se establecieron las tradiciones que perduran hasta hoy: el respeto por la historia, la devoción a la tradición, y el compromiso con la excelencia en cada desfile y acto.',
            'Los primeros trajes fueron diseñados con gran atención al detalle histórico, basándose en las vestimentas reales de los caballeros templarios, con sus característicos mantos blancos con la cruz roja.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '1986-1990'
    ],
    [
        'titulo' => 'Época de Crecimiento',
        'subtitulo' => 'Capítulo III - Expansión y Reconocimiento',
        'contenido' => [
            'Durante la década de los 90, la Filá Mariscales experimentó un crecimiento significativo en su número de miembros y en su prestigio dentro de las fiestas. Cada año, nuevos caballeros se unían a la hermandad.',
            'En 1995, la filá celebró su décimo aniversario con una gran ceremonia que incluyó un desfile especial por las calles de Elche, conmemorando los logros alcanzados y renovando el compromiso con la tradición.',
            'Durante estos años, la filá comenzó a participar en eventos fuera de Elche, representando a la ciudad en fiestas de Moros y Cristianos de otras localidades, llevando el nombre de Elche y la tradición templaria por toda España.',
            'Se establecieron las primeras relaciones de hermanamiento con otras filaes templarias de diferentes ciudades, creando una red de hermandad que perdura hasta nuestros días.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1544966503-7cc5ac882d5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '1990-2000'
    ],
    [
        'titulo' => 'Siglo XXI - Modernización',
        'subtitulo' => 'Capítulo IV - Tradición y Progreso',
        'contenido' => [
            'Con la llegada del nuevo milenio, la Filá Mariscales emprendió un proceso de modernización que mantendría la esencia tradicional pero incorporaría las ventajas de la tecnología y la comunicación moderna.',
            'En 2005, se celebró el vigésimo aniversario con un evento que reunió a todas las generaciones de la filá, desde los fundadores hasta los miembros más jóvenes, demostrando la continuidad y vitalidad de la tradición.',
            'Durante estos años, se mejoraron significativamente los trajes y equipamiento, incorporando materiales más duraderos y cómodos, pero manteniendo la fidelidad histórica a los caballeros templarios.',
            'Se establecieron programas de formación para nuevos miembros, asegurando que cada generación comprenda y valore la historia y tradición de la filá, garantizando así la continuidad del legado templario.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '2000-2010'
    ],
    [
        'titulo' => 'Era Digital y Expansión',
        'subtitulo' => 'Capítulo V - Conectando Generaciones',
        'contenido' => [
            'En la década de 2010, la Filá Mariscales abrazó la era digital, creando presencia en redes sociales y desarrollando una página web que permitiera compartir la historia y actividades de la filá con el mundo.',
            'En 2015, se celebró el trigésimo aniversario con un evento que incluyó exposiciones históricas, conferencias sobre la historia templaria, y un gran desfile que atrajo a miles de espectadores.',
            'Durante estos años, la filá comenzó a organizar eventos culturales y educativos, incluyendo charlas sobre historia medieval, talleres de heráldica, y visitas a castillos y monumentos templarios.',
            'Se establecieron programas de intercambio con otras organizaciones templarias internacionales, expandiendo el alcance y la influencia de la Filá Mariscales más allá de las fronteras españolas.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '2010-2020'
    ],
    [
        'titulo' => 'El Presente y Futuro',
        'subtitulo' => 'Capítulo VI - Legado Eterno',
        'contenido' => [
            'Hoy, en 2024, la Filá Mariscales de Caballeros Templarios se encuentra en su momento más fuerte, con más de 150 miembros activos y una reputación que trasciende las fronteras de Elche.',
            'La filá continúa siendo un pilar fundamental de las Fiestas de Moros y Cristianos, manteniendo viva la tradición medieval y el espíritu de los caballeros templarios para las generaciones futuras.',
            'Los proyectos actuales incluyen la digitalización completa del archivo histórico, la creación de un museo virtual, y la expansión de los programas educativos para jóvenes interesados en la historia medieval.',
            'El compromiso con la tradición, el honor y la excelencia sigue siendo el pilar fundamental de la Filá Mariscales, asegurando que el legado de los caballeros templarios perdure por muchos siglos más.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '2020-Presente'
    ]
];

$total_paginas = count($libro_paginas);
?>

<!-- Hero Section -->
<section class="hero-section py-5" style="background: rgba(0, 0, 0, 0.1); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10 text-center">
                <h1 class="display-4 fw-bold text-gradient mb-4">
                    <i class="bi bi-book-open me-3"></i>Libro de la Historia
                </h1>
                <p class="lead mb-5">Crónicas de la Filá Mariscales de Caballeros Templarios</p>
                <div class="book-stats d-flex justify-content-center gap-4 mb-5">
                    <div class="stat-item">
                        <h3 class="text-gradient mb-0"><?php echo $total_paginas; ?></h3>
                        <small class="text-muted">Capítulos</small>
                    </div>
                    <div class="stat-item">
                        <h3 class="text-gradient mb-0">39</h3>
                        <small class="text-muted">Años de Historia</small>
                    </div>
                    <div class="stat-item">
                        <h3 class="text-gradient mb-0">150+</h3>
                        <small class="text-muted">Miembros</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Flipbook Container -->
<section class="flipbook-section py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <div class="flipbook-container">
                    <div class="flipbook-controls">
                        <button id="prevPage" class="btn btn-outline-danger">
                            <i class="bi bi-chevron-left me-2"></i>Anterior
                        </button>
                        <div class="page-info">
                            <span id="currentPage">1</span> de <?php echo $total_paginas; ?>
                        </div>
                        <button id="nextPage" class="btn btn-outline-danger">
                            Siguiente<i class="bi bi-chevron-right ms-2"></i>
                        </button>
                    </div>
                    
                    <div class="flipbook-wrapper">
                        <div class="flipbook" id="flipbook">
                            <?php foreach ($libro_paginas as $index => $pagina): ?>
                            <div class="page" data-page="<?php echo $index + 1; ?>">
                                <div class="page-content">
                                    <div class="page-header">
                                        <div class="page-number">Capítulo <?php echo $index + 1; ?></div>
                                        <div class="page-date"><?php echo $pagina['fecha']; ?></div>
                                    </div>
                                    
                                    <div class="page-body">
                                        <div class="row h-100">
                                            <div class="col-lg-8">
                                                <h2 class="page-title"><?php echo $pagina['titulo']; ?></h2>
                                                <h4 class="page-subtitle"><?php echo $pagina['subtitulo']; ?></h4>
                                                
                                                <div class="page-text">
                                                    <?php foreach ($pagina['contenido'] as $parrafo): ?>
                                                    <p><?php echo $parrafo; ?></p>
                                                    <?php endforeach; ?>
                                                </div>
                                            </div>
                                            
                                            <div class="col-lg-4">
                                                <div class="page-image">
                                                    <img src="<?php echo $pagina['imagen']; ?>" 
                                                         alt="<?php echo $pagina['titulo']; ?>" 
                                                         class="img-fluid">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="page-footer">
                                        <div class="page-quote">
                                            <blockquote>
                                                <p>
                                                    <i class="bi bi-quote me-2"></i>
                                                    "La tradición no es adorar las cenizas, sino mantener viva la llama."
                                                </p>
                                                <footer>
                                                    <cite>Filá Mariscales</cite>
                                                </footer>
                                            </blockquote>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <?php endforeach; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Chapter Navigation -->
<section class="chapter-nav py-4">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <h4 class="text-center mb-4">Navegación por Capítulos</h4>
                <div class="chapter-grid">
                    <?php foreach ($libro_paginas as $index => $pagina): ?>
                    <button class="chapter-btn" data-page="<?php echo $index + 1; ?>">
                        <div class="chapter-number"><?php echo $index + 1; ?></div>
                        <div class="chapter-title"><?php echo $pagina['titulo']; ?></div>
                        <div class="chapter-date"><?php echo $pagina['fecha']; ?></div>
                    </button>
                    <?php endforeach; ?>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
/* Hero Section */
.hero-section {
    background: linear-gradient(135deg, rgba(220, 20, 60, 0.05) 0%, rgba(255, 255, 255, 0.7) 50%, rgba(220, 20, 60, 0.05) 100%);
    border-bottom: 3px solid var(--primary);
    backdrop-filter: blur(5px);
}

.book-stats .stat-item {
    text-align: center;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 10px;
    border: 2px solid var(--primary);
    min-width: 120px;
    backdrop-filter: blur(10px);
}

/* Flipbook Styles */
.flipbook-section {
    background: linear-gradient(135deg, rgba(248, 249, 250, 0.8) 0%, rgba(233, 236, 239, 0.8) 100%);
    min-height: 80vh;
}

.flipbook-container {
    position: relative;
    max-width: 1200px;
    margin: 0 auto;
}

.flipbook-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.page-info {
    font-family: 'Cinzel', serif;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
}

.flipbook-wrapper {
    perspective: 1000px;
    height: 600px;
    position: relative;
}

.flipbook {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
}

.page {
    position: absolute;
    width: 100%;
    height: 100%;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border: 3px solid var(--primary);
    transform-origin: left center;
    transition: transform 0.8s ease-in-out;
    backface-visibility: hidden;
    display: none;
}

.page.active {
    display: block;
    transform: rotateY(0deg);
}

.page.flipping {
    transform: rotateY(-180deg);
}

.page-content {
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 0;
    overflow: hidden;
}

.page-header {
    background: linear-gradient(135deg, rgba(220, 20, 60, 0.9) 0%, rgba(139, 0, 0, 0.9) 100%);
    color: white;
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: 'Cinzel', serif;
}

.page-number {
    font-size: 1.5rem;
    font-weight: 700;
}

.page-date {
    font-size: 1.1rem;
    opacity: 0.9;
}

.page-body {
    flex: 1;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.95);
    overflow-y: auto;
}

.page-title {
    font-family: 'Cinzel', serif;
    font-size: 2.2rem;
    font-weight: 700;
    color: var(--primary);
    border-bottom: 3px solid var(--accent);
    padding-bottom: 1rem;
    margin-bottom: 1rem;
}

.page-subtitle {
    font-family: 'Crimson Text', serif;
    font-style: italic;
    font-size: 1.2rem;
    color: #666;
    margin-bottom: 1.5rem;
}

.page-text p {
    font-family: 'Crimson Text', serif;
    font-size: 1.1rem;
    line-height: 1.8;
    text-align: justify;
    color: #333;
    margin-bottom: 1rem;
}

.page-image {
    height: 100%;
    display: flex;
    align-items: center;
}

.page-image img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 10px;
    border: 3px solid var(--accent);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.page-footer {
    background: linear-gradient(135deg, rgba(248, 249, 250, 0.9) 0%, rgba(233, 236, 239, 0.9) 100%);
    padding: 1.5rem;
    border-top: 2px solid var(--primary);
}

.page-quote {
    text-align: center;
    font-style: italic;
}

.page-quote blockquote {
    border-left: 4px solid var(--primary);
    padding-left: 1rem;
    margin: 0;
}

.page-quote p {
    font-size: 1rem;
    color: #555;
    margin-bottom: 0.5rem;
}

.page-quote cite {
    font-size: 0.9rem;
    color: var(--primary);
    font-weight: 600;
}

/* Chapter Navigation */
.chapter-nav {
    background: rgba(248, 249, 250, 0.8);
    border-top: 2px solid var(--primary);
    backdrop-filter: blur(10px);
}

.chapter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.chapter-btn {
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid var(--primary);
    border-radius: 10px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    backdrop-filter: blur(5px);
}

.chapter-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
}

.chapter-btn.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
}

.chapter-number {
    font-family: 'Cinzel', serif;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.chapter-title {
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.chapter-date {
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Responsive */
@media (max-width: 768px) {
    .flipbook-wrapper {
        height: 500px;
    }
    
    .page-body {
        padding: 1.5rem;
    }
    
    .page-title {
        font-size: 1.8rem;
    }
    
    .chapter-grid {
        grid-template-columns: 1fr;
    }
    
    .book-stats {
        flex-direction: column;
        gap: 1rem;
    }
    
    .flipbook-controls {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const pages = document.querySelectorAll('.page');
    const chapterBtns = document.querySelectorAll('.chapter-btn');
    const prevBtn = document.getElementById('prevPage');
    const nextBtn = document.getElementById('nextPage');
    const currentPageSpan = document.getElementById('currentPage');
    
    let currentPage = 1;
    const totalPages = pages.length;
    let isFlipping = false;
    
    function showPage(pageNumber) {
        if (isFlipping) return;
        
        isFlipping = true;
        
        // Hide current page with flip animation
        const currentPageEl = document.querySelector('.page.active');
        if (currentPageEl) {
            currentPageEl.classList.add('flipping');
            currentPageEl.classList.remove('active');
        }
        
        // Show new page after animation
        setTimeout(() => {
            const targetPage = document.querySelector(`[data-page="${pageNumber}"]`);
            if (targetPage) {
                targetPage.classList.add('active');
                targetPage.classList.remove('flipping');
            }
            
            // Update navigation
            currentPageSpan.textContent = pageNumber;
            
            // Update chapter buttons
            chapterBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            
            const targetBtn = document.querySelector(`.chapter-btn[data-page="${pageNumber}"]`);
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
            
            // Update navigation buttons
            prevBtn.disabled = pageNumber === 1;
            nextBtn.disabled = pageNumber === totalPages;
            
            isFlipping = false;
        }, 400);
    }
    
    // Event listeners
    prevBtn.addEventListener('click', () => {
        if (currentPage > 1 && !isFlipping) {
            currentPage--;
            showPage(currentPage);
        }
    });
    
    nextBtn.addEventListener('click', () => {
        if (currentPage < totalPages && !isFlipping) {
            currentPage++;
            showPage(currentPage);
        }
    });
    
    chapterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const pageNumber = parseInt(btn.dataset.page);
            if (pageNumber !== currentPage && !isFlipping) {
                currentPage = pageNumber;
                showPage(pageNumber);
            }
        });
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (isFlipping) return;
        
        if (e.key === 'ArrowLeft' && currentPage > 1) {
            currentPage--;
            showPage(currentPage);
        } else if (e.key === 'ArrowRight' && currentPage < totalPages) {
            currentPage++;
            showPage(currentPage);
        }
    });
    
    // Touch/swipe support
    let startX = 0;
    let startY = 0;
    
    document.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
    });
    
    document.addEventListener('touchend', (e) => {
        if (isFlipping) return;
        
        const endX = e.changedTouches[0].clientX;
        const endY = e.changedTouches[0].clientY;
        const diffX = startX - endX;
        const diffY = startY - endY;
        
        // Only trigger if horizontal swipe is more significant than vertical
        if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
            if (diffX > 0 && currentPage < totalPages) {
                // Swipe left - next page
                currentPage++;
                showPage(currentPage);
            } else if (diffX < 0 && currentPage > 1) {
                // Swipe right - previous page
                currentPage--;
                showPage(currentPage);
            }
        }
    });
    
    // Initialize
    showPage(1);
});
</script>