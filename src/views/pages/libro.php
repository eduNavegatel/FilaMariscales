<?php 
// Datos del libro - Historia de la Fil√° Mariscales
$libro_paginas = [
    [
        'titulo' => 'Fundaci√≥n de la Fil√° Mariscales',
        'subtitulo' => 'Cap√≠tulo I - Los Or√≠genes Sagrados',
        'contenido' => [
            'En el a√±o de Nuestro Se√±or 1985, cuando las estrellas se alinearon en el firmamento de Elche, un grupo de visionarios decidi√≥ crear algo extraordinario. Nac√≠a as√≠ la Fil√° Mariscales de Caballeros Templarios, una comparsa que honrar√≠a la tradici√≥n medieval y el esp√≠ritu de los templarios.',
            'Los fundadores, inspirados por la nobleza y el honor de los caballeros templarios, establecieron los cimientos de lo que hoy es una de las filaes m√°s respetadas de las Fiestas de Moros y Cristianos.',
            'Desde el primer momento, se decidi√≥ que la fil√° representar√≠a a los Caballeros Templarios, una de las √≥rdenes militares m√°s importantes de la Edad Media, conocida por su valent√≠a, honor y devoci√≥n a la fe cristiana.',
            'El nombre "Mariscales" fue elegido para honrar a los mariscales medievales, oficiales de alto rango que comandaban las tropas en batalla, simbolizando as√≠ el liderazgo y la estrategia militar.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '1985'
    ],
    [
        'titulo' => 'Los Primeros A√±os',
        'subtitulo' => 'Cap√≠tulo II - Construyendo la Tradici√≥n',
        'contenido' => [
            'Los primeros a√±os fueron de aprendizaje y consolidaci√≥n. Los miembros fundadores trabajaron incansablemente para establecer las bases de la fil√°, creando los estatutos, dise√±ando los trajes y organizando las primeras participaciones en las fiestas.',
            'En 1986, la Fil√° Mariscales particip√≥ por primera vez en las Fiestas de Moros y Cristianos de Elche, causando una gran impresi√≥n con sus trajes de caballeros templarios y su organizaci√≥n impecable.',
            'Durante estos a√±os iniciales, se establecieron las tradiciones que perduran hasta hoy: el respeto por la historia, la devoci√≥n a la tradici√≥n, y el compromiso con la excelencia en cada desfile y acto.',
            'Los primeros trajes fueron dise√±ados con gran atenci√≥n al detalle hist√≥rico, bas√°ndose en las vestimentas reales de los caballeros templarios, con sus caracter√≠sticos mantos blancos con la cruz roja.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '1986-1990'
    ],
    [
        'titulo' => '√âpoca de Crecimiento',
        'subtitulo' => 'Cap√≠tulo III - Expansi√≥n y Reconocimiento',
        'contenido' => [
            'Durante la d√©cada de los 90, la Fil√° Mariscales experiment√≥ un crecimiento significativo en su n√∫mero de miembros y en su prestigio dentro de las fiestas. Cada a√±o, nuevos caballeros se un√≠an a la hermandad.',
            'En 1995, la fil√° celebr√≥ su d√©cimo aniversario con una gran ceremonia que incluy√≥ un desfile especial por las calles de Elche, conmemorando los logros alcanzados y renovando el compromiso con la tradici√≥n.',
            'Durante estos a√±os, la fil√° comenz√≥ a participar en eventos fuera de Elche, representando a la ciudad en fiestas de Moros y Cristianos de otras localidades, llevando el nombre de Elche y la tradici√≥n templaria por toda Espa√±a.',
            'Se establecieron las primeras relaciones de hermanamiento con otras filaes templarias de diferentes ciudades, creando una red de hermandad que perdura hasta nuestros d√≠as.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1544966503-7cc5ac882d5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '1990-2000'
    ],
    [
        'titulo' => 'Siglo XXI - Modernizaci√≥n',
        'subtitulo' => 'Cap√≠tulo IV - Tradici√≥n y Progreso',
        'contenido' => [
            'Con la llegada del nuevo milenio, la Fil√° Mariscales emprendi√≥ un proceso de modernizaci√≥n que mantendr√≠a la esencia tradicional pero incorporar√≠a las ventajas de la tecnolog√≠a y la comunicaci√≥n moderna.',
            'En 2005, se celebr√≥ el vig√©simo aniversario con un evento que reuni√≥ a todas las generaciones de la fil√°, desde los fundadores hasta los miembros m√°s j√≥venes, demostrando la continuidad y vitalidad de la tradici√≥n.',
            'Durante estos a√±os, se mejoraron significativamente los trajes y equipamiento, incorporando materiales m√°s duraderos y c√≥modos, pero manteniendo la fidelidad hist√≥rica a los caballeros templarios.',
            'Se establecieron programas de formaci√≥n para nuevos miembros, asegurando que cada generaci√≥n comprenda y valore la historia y tradici√≥n de la fil√°, garantizando as√≠ la continuidad del legado templario.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '2000-2010'
    ],
    [
        'titulo' => 'Era Digital y Expansi√≥n',
        'subtitulo' => 'Cap√≠tulo V - Conectando Generaciones',
        'contenido' => [
            'En la d√©cada de 2010, la Fil√° Mariscales abraz√≥ la era digital, creando presencia en redes sociales y desarrollando una p√°gina web que permitiera compartir la historia y actividades de la fil√° con el mundo.',
            'En 2015, se celebr√≥ el trig√©simo aniversario con un evento que incluy√≥ exposiciones hist√≥ricas, conferencias sobre la historia templaria, y un gran desfile que atrajo a miles de espectadores.',
            'Durante estos a√±os, la fil√° comenz√≥ a organizar eventos culturales y educativos, incluyendo charlas sobre historia medieval, talleres de her√°ldica, y visitas a castillos y monumentos templarios.',
            'Se establecieron programas de intercambio con otras organizaciones templarias internacionales, expandiendo el alcance y la influencia de la Fil√° Mariscales m√°s all√° de las fronteras espa√±olas.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '2010-2020'
    ],
    [
        'titulo' => 'El Presente y Futuro',
        'subtitulo' => 'Cap√≠tulo VI - Legado Eterno',
        'contenido' => [
            'Hoy, en 2024, la Fil√° Mariscales de Caballeros Templarios se encuentra en su momento m√°s fuerte, con m√°s de 150 miembros activos y una reputaci√≥n que trasciende las fronteras de Elche.',
            'La fil√° contin√∫a siendo un pilar fundamental de las Fiestas de Moros y Cristianos, manteniendo viva la tradici√≥n medieval y el esp√≠ritu de los caballeros templarios para las generaciones futuras.',
            'Los proyectos actuales incluyen la digitalizaci√≥n completa del archivo hist√≥rico, la creaci√≥n de un museo virtual, y la expansi√≥n de los programas educativos para j√≥venes interesados en la historia medieval.',
            'El compromiso con la tradici√≥n, el honor y la excelencia sigue siendo el pilar fundamental de la Fil√° Mariscales, asegurando que el legado de los caballeros templarios perdure por muchos siglos m√°s.'
        ],
        'imagen' => 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
        'fecha' => '2020-Presente'
    ]
];

$total_paginas = count($libro_paginas);
?>

<!-- Hero Section -->
<section class="hero-section py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10 text-center">
                <h1 class="display-4 fw-bold text-gradient mb-4">
                    <i class="fas fa-book-open me-3"></i>Libro de la Historia
                </h1>
                <p class="lead mb-5">Cr√≥nicas de la Fil√° Mariscales de Caballeros Templarios</p>
                <div class="book-stats d-flex justify-content-center gap-4 mb-5">
                    <div class="stat-item">
                        <h3 class="text-gradient mb-0"><?php echo $total_paginas; ?></h3>
                        <small class="text-muted">Cap√≠tulos</small>
                    </div>
                    <div class="stat-item">
                        <h3 class="text-gradient mb-0">39</h3>
                        <small class="text-muted">A√±os de Historia</small>
                    </div>
                    <div class="stat-item">
                        <h3 class="text-gradient mb-0">150+</h3>
                        <small class="text-muted">Miembros</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Flip Book Container -->
<section class="flipbook-section py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <div class="flipbook-instructions text-center mb-4">
                    <h4 class="text-gradient mb-3">
                        <i class="fas fa-hand-pointer me-2"></i>Instrucciones de Uso
                    </h4>
                    <div class="instructions-grid">
                        <div class="instruction-item">
                            <i class="fas fa-mouse-pointer"></i>
                            <span>Haz clic en las p√°ginas para navegar</span>
                        </div>
                        <div class="instruction-item">
                            <i class="fas fa-keyboard"></i>
                            <span>Usa las flechas del teclado</span>
                        </div>
                        <div class="instruction-item">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Desliza en dispositivos m√≥viles</span>
                        </div>
                        <div class="instruction-item">
                            <i class="fas fa-home"></i>
                            <span>Home/End para ir al inicio/final</span>
                        </div>
                    </div>
                </div>
                
                <div id="flipbookContainer" class="flipbook-container">
                    <div class="flipbook-loading">
                        Cargando el libro hist√≥rico...
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Chapter Navigation -->
<section class="chapter-nav py-4">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <h4 class="text-center mb-4">
                    <i class="fas fa-list me-2"></i>Navegaci√≥n por Cap√≠tulos
                </h4>
                <div class="chapter-grid">
                    <?php foreach ($libro_paginas as $index => $pagina): ?>
                    <button class="chapter-btn <?php echo $index === 0 ? 'active' : ''; ?>" 
                            data-page="<?php echo $index + 1; ?>">
                        <div class="chapter-number"><?php echo $index + 1; ?></div>
                        <div class="chapter-title"><?php echo $pagina['titulo']; ?></div>
                        <div class="chapter-date"><?php echo $pagina['fecha']; ?></div>
                    </button>
                    <?php endforeach; ?>
                </div>
            </div>
        </div>
    </div>
</section>
    
    <style>
/* Book Styles */
.hero-section {
    background: linear-gradient(135deg, rgba(220, 20, 60, 0.05) 0%, rgba(255, 255, 255, 0.7) 50%, rgba(220, 20, 60, 0.05) 100%);
    border-bottom: 3px solid var(--primary);
    backdrop-filter: blur(5px);
}

.book-stats .stat-item {
    text-align: center;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 10px;
    border: 2px solid var(--primary);
    min-width: 120px;
    backdrop-filter: blur(10px);
}

/* Flip Book Instructions */
.flipbook-instructions {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    padding: 2rem;
    border: 2px solid var(--primary);
    backdrop-filter: blur(10px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.instructions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.instruction-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    background: rgba(220, 20, 60, 0.1);
    border-radius: 8px;
    font-size: 0.9rem;
    color: var(--primary);
}

.instruction-item i {
    font-size: 1.2rem;
    color: var(--primary);
}

/* Chapter Navigation */
.chapter-nav {
    background: rgba(248, 249, 250, 0.8);
    border-top: 2px solid var(--primary);
    backdrop-filter: blur(10px);
}

.chapter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.chapter-btn {
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid var(--primary);
    border-radius: 10px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    backdrop-filter: blur(5px);
}

.chapter-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
}

.chapter-btn.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
}

.chapter-number {
    font-family: 'Cinzel', serif;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.chapter-title {
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.chapter-date {
    font-size: 0.9rem;
    opacity: 0.8;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Responsive */
@media (max-width: 768px) {
    .instructions-grid {
        grid-template-columns: 1fr;
    }
    
    .chapter-grid {
        grid-template-columns: 1fr;
    }
    
    .book-stats {
        flex-direction: column;
        gap: 1rem;
    }
}
    </style>

<script>
// Datos del libro para el flip book
const libroPaginas = <?php echo json_encode($libro_paginas); ?>;

document.addEventListener('DOMContentLoaded', function() {
    const chapterBtns = document.querySelectorAll('.chapter-btn');
    let flipBookInstance = null;
    
    // Inicializar el flip book
    function initFlipBookInstance() {
        if (typeof FlipBook !== 'undefined') {
            flipBookInstance = new FlipBook(document.getElementById('flipbookContainer'), libroPaginas);
            
            console.log('üìñ Flip Book inicializado correctamente');
            
            // Conectar botones de cap√≠tulos con el flip book
            chapterBtns.forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    flipBookInstance.goToPage(index);
                });
            });
        } else {
            console.error('‚ùå FlipBook class no est√° disponible');
        }
    }
    
    // Cargar los archivos CSS y JS del flip book
    function loadFlipBookResources() {
        // Cargar CSS
        const flipbookCSS = document.createElement('link');
        flipbookCSS.rel = 'stylesheet';
        flipbookCSS.href = '/prueba-php/public/assets/css/flipbook.css';
        document.head.appendChild(flipbookCSS);
        
        // Cargar JS
        const flipbookJS = document.createElement('script');
        flipbookJS.src = '/prueba-php/public/assets/js/flipbook.js';
        flipbookJS.onload = () => {
            // Esperar un poco para que se cargue completamente
            setTimeout(initFlipBookInstance, 100);
        };
        document.head.appendChild(flipbookJS);
    }
    
    // Iniciar carga de recursos
    loadFlipBookResources();
    
    // Actualizar botones de cap√≠tulos
    function updateChapterButtons(currentPage) {
        chapterBtns.forEach((btn, index) => {
            btn.classList.toggle('active', index === currentPage);
        });
    }
    
    // Event listener para actualizar botones cuando cambie la p√°gina
    document.addEventListener('flipbookPageChanged', (e) => {
        updateChapterButtons(e.detail.currentPage);
    });
    
    // Keyboard shortcuts adicionales
    document.addEventListener('keydown', (e) => {
        if (!flipBookInstance) return;
        
        switch(e.key) {
            case '1':
            case '2':
            case '3':
            case '4':
            case '5':
            case '6':
                const pageIndex = parseInt(e.key) - 1;
                if (pageIndex < libroPaginas.length) {
                    flipBookInstance.goToPage(pageIndex);
                }
                break;
        }
    });
    
    // Efectos especiales al cargar
    setTimeout(() => {
        const container = document.getElementById('flipbookContainer');
        if (container) {
            container.style.opacity = '0';
            container.style.transform = 'scale(0.9)';
            
            setTimeout(() => {
                container.style.transition = 'all 0.8s ease';
                container.style.opacity = '1';
                container.style.transform = 'scale(1)';
            }, 100);
        }
    }, 500);
});
</script>
